#
# Makefile for ct-cbn
#

## A modification by RDU to avoid dependencies on specific varions of gcc
## Use by running make -f Makefile-cbn-modified-RDU in the H-CBN directory


VERSION = 0.1.04

#CC = gcc -Wall -O3 -march=core2 -fopenmp # -pg
## CC = gcc-4.2 -Wall -O2 -fopenmp -march=core2 # -pg
## previous line was the original, I modify it
CC = gcc -Wall -O2 -fopenmp  -march=native -Q -v
#CC = gcc -Wall -O2 -fopenmp -march=nocona  $(DEBUG)
ARCH = $(shell arch)
GSL_PATH = /usr/local/bewi/

BUILD_DIR = build
VPATH = src

all: cbn

queue.o: queue.c
	$(CC) -c $^ -o $@

$(BUILD_DIR)/ct-cbn: ct-cbn.c ct-cbn.h queue.h queue.o
	$(CC)  $^ -I/usr/local/include -L/usr/local/lib -lgsl -lgslcblas -lm -o $@
#	$(CC) ct-cbn.o queue.o -L/opt/local/lib -lgsl -lgslcblas -lm -o $@

$(BUILD_DIR)/h-cbn: h-cbn.c ct-cbn.h queue.h queue.o
	$(CC) $^ -I/usr/local/include -L/usr/local/lib -lgsl -lgslcblas -lm -o $@


cbn: $(BUILD_DIR)/ct-cbn $(BUILD_DIR)/h-cbn

archive:
	tar cvf ct-cbn-$(VERSION).tar \
		--exclude ".*" \
		Makefile \
		README \
		CHANGELOG \
	       	examples/ \
		src/
	gzip ct-cbn-$(VERSION).tar


clean:
	rm -f a.out core *.o ct-cbn *~ h-cbn



